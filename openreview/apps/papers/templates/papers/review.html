{% load markdown %}
{% load author %}

<section data-paper-id="{{ review.paper_id }}" data-review-id="{{ review.id }}" class="review box">
    <div class="voting">
      <a class="up">❮</a>
      <span class="counter">{{ review.score }}</span>
      <a class="down">❯</a>
    </div>

    <header>
        <span class="author">
            {{ review|format_author}}
            <a href="{% url 'review' review.paper_id review.id %}">wrote on {{ review.timestamp }}</a>:
        </span>

        {% if review.rating != -1 %}
        <span class="rating">
            {% for i in "1234567" %}
                {% if review.rating > forloop.counter0 %}★{% else %}☆{% endif %}
            {% endfor %}
        </span>
        {% endif %}
    </header>

    <article class="content {% if review.is_deleted %}deleted{% endif %}">
        {% if review.text %}
            {{ review.text|markdown }}
        {% else %}
            <p class="deleted">[deleted]</p>
        {% endif %}
    </article>
</section>

<section class="comments box">
    {% for comment in review.get_comments %}
        <section class="comment">
            <span class="author">{{ comment|format_author }} <a href="#">commented:</a></span>
            {% if comment.text %}
                {{ comment.text|markdown }}
            {% else %}
                <p class="deleted">[deleted]</p>
            {% endif %}
        </section>
    {% endfor %}

    <section data-preview-id="preview-of-comment-on-{{ review.id }}" class="compose compose-comment">
        <form action="" method="POST">
            {% csrf_token %}
            <input name="rating" type="hidden" value="-1" />
            {% include "papers/comment.html" %}
        </form>
    </section>

    <div id="preview-of-comment-on-{{ review.id }}"></div>

</section>

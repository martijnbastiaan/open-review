{% load markdown %}

<section class="review-container">
  <div id="r{{ review.id }}" review_id="{{ review.id }}" class="bs-callout bs-callout-info review">
    <header>
      <i class="glyphicon glyphicon-user"></i>
      <span class="author">
          {% if review.poster == None %}
            ?
          {% else %}
            {{ review.poster.username }}
          {% endif %}
      </span>
      on
      <span class="timestamp" unix="{{ review.timestamp|date:'U' }}">
        {{ review.timestamp }}
      </span>
      
      {% if not review.parent %}
      <span class="starfield" data-readonly="true" data-score="{{ review.rating }}"></span>
      {% endif %}
    </header>

    <article {% if review.is_deleted %}class="deleted"{% endif %}>
      {{ review.text|default_if_none:""|markdown }}
    </article>

{% if not preview %}
    <footer>
      <span class="options">
        {% include "papers/review-options.html" with review=review paper=paper %}
      </span>
      <span style="display:none;" class="deleted-message">
        You cannot cast votes on deleted reviews/comments.
      </span>
      <span style="display:none;" class="login-message">
        You must be <a href="{% url "accounts-login" %}?next={{ url }}">logged in</a> to vote or comment!
      </span>
    </footer>
{% endif %}
  </div>

{% if not preview %}
  <div style="display:none;" class="new">
    {% include "papers/comment.html" with review=new_review parent=review %}
  </div>

  <div style="display:none;" class="edit">
    {% if review.is_review %}
        <form method="post" action="{% url 'paper' paper.id %}" data-preview="{% url 'preview' paper.id %}" class="new">
            {% csrf_token %}
            <table>{{ edit_review_form }}</table>
            <br /><input name="{{ edit_review_name }}" type="submit" value="Edit review">
            {% include "papers/preview.html" %}
        </form>
    {% else %}
        {% include "papers/comment.html" with review=review parent=review.parent %}
    {% endif %}
  </div>
{% endif %}
</section>


